<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0"
		/>
		<title>First Reach Out Email Application</title>
		<style>
			body {
				font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
				max-width: 1200px;
				margin: 0 auto;
				padding: 20px;
				background-color: #f5f5f5;
			}
			.container {
				background-color: white;
				padding: 30px;
				border-radius: 8px;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
			}
			h1, h2 {
				text-align: center;
				color: #2c3e50;
				margin-bottom: 30px;
			}
			.form-group {
				margin-bottom: 20px;
			}
			label {
				display: block;
				margin-bottom: 8px;
				font-weight: 600;
				color: #2c3e50;
			}
			input[type='text'],
			input[type='email'],
			input[type='password'],
			textarea {
				width: 100%;
				padding: 10px;
				border: 1px solid #ddd;
				border-radius: 4px;
				font-size: 16px;
			}
			textarea {
				min-height: 120px;
				resize: vertical;
			}
			.btn {
				background-color: #3498db;
				color: white;
				border: none;
				padding: 10px 15px;
				border-radius: 4px;
				cursor: pointer;
				font-size: 16px;
				transition: background-color 0.3s;
			}
			.btn:hover {
				background-color: #2980b9;
			}
			.btn-danger {
				background-color: #e74c3c;
			}
			.btn-danger:hover {
				background-color: #c0392b;
			}
			.btn-success {
				background-color: #2ecc71;
			}
			.btn-success:hover {
				background-color: #27ae60;
			}
			.email-preview {
				background-color: #f9f9f9;
				padding: 20px;
				border-radius: 4px;
				margin-top: 30px;
				border: 1px solid #ddd;
			}
			.email-preview h3 {
				margin-top: 0;
				border-bottom: 1px solid #ddd;
				padding-bottom: 10px;
			}
			.preview-content {
				white-space: pre-line;
			}
			.form-footer {
				margin-top: 30px;
				text-align: center;
			}
			#resumeFileName {
				margin-left: 10px;
				font-style: italic;
			}
			.resume-container {
				display: flex;
				align-items: center;
			}
			#status {
				margin-top: 20px;
				padding: 15px;
				border-radius: 4px;
				text-align: center;
				display: none;
			}
			.status-success {
				background-color: #d4edda;
				color: #155724;
				border: 1px solid #c3e6cb;
			}
			.status-error {
				background-color: #f8d7da;
				color: #721c24;
				border: 1px solid #f5c6cb;
			}
			.loading {
				display: none;
				text-align: center;
				margin-top: 20px;
			}
			.loading-spinner {
				border: 4px solid #f3f3f3;
				border-top: 4px solid #3498db;
				border-radius: 50%;
				width: 30px;
				height: 30px;
				animation: spin 2s linear infinite;
				margin: 0 auto;
			}
			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}
			.sent-email {
				background-color: #eafbea;
				padding: 10px;
				margin-bottom: 10px;
				border-radius: 4px;
				border-left: 3px solid #28a745;
			}
			#sentEmails {
				margin-top: 30px;
				display: none;
			}
			.sender-section {
				background-color: #f8f9fa;
				padding: 15px;
				border-radius: 4px;
				margin-bottom: 20px;
				border: 1px solid #e9ecef;
			}
			.grid-container {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 15px;
			}
			.full-width {
				grid-column: 1 / span 2;
			}
			fieldset {
				border: 1px solid #ddd;
				border-radius: 4px;
				padding: 15px;
				margin-bottom: 20px;
			}
			legend {
				padding: 0 10px;
				font-weight: 600;
				color: #2c3e50;
			}
			.info-text {
				font-size: 14px;
				color: #6c757d;
				margin-top: 5px;
			}
			
			/* CSV import styles */
			.csv-upload-section {
				margin-bottom: 30px;
				padding: 20px;
				background-color: #f0f7ff;
				border-radius: 8px;
				border: 1px dashed #3498db;
			}
			.csv-table-container {
				margin-top: 20px;
				overflow-x: auto;
				max-height: 500px;
				overflow-y: auto;
			}
			.csv-table {
				width: 100%;
				border-collapse: collapse;
				font-size: 14px;
			}
			.csv-table th {
				background-color: #eef5f9;
				padding: 10px;
				position: sticky;
				top: 0;
				z-index: 10;
			}
			.csv-table td, .csv-table th {
				border: 1px solid #ddd;
				padding: 8px;
				text-align: left;
			}
			.csv-table tr:nth-child(even) {
				background-color: #f9f9f9;
			}
			.csv-table tr:hover {
				background-color: #f1f1f1;
			}
			.csv-controls {
				margin: 15px 0;
				display: flex;
				justify-content: space-between;
				align-items: center;
			}
			.csv-stats {
				background-color: #eef5f9;
				padding: 10px;
				border-radius: 4px;
				font-size: 14px;
				margin-bottom: 15px;
			}
			.select-all-container {
				margin-bottom: 10px;
			}
			.search-filter {
				padding: 8px;
				width: 300px;
				border-radius: 4px;
				border: 1px solid #ddd;
				margin-right: 10px;
			}
			.badge {
				background-color: #3498db;
				color: white;
				padding: 3px 8px;
				border-radius: 10px;
				font-size: 12px;
				margin-left: 5px;
			}
			.section {
				margin-bottom: 30px;
			}
			.app-section {
				margin-bottom: 30px;
				border: 1px solid #ddd;
				border-radius: 8px;
				padding: 20px;
			}
			.app-section h2 {
				margin-top: 0;
			}
			.summary-box {
				background-color: #eef5f9;
				padding: 15px;
				border-radius: 4px;
				margin-bottom: 15px;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h1>Recruiter Email Application</h1>
			
			<form id="emailForm">
				<!-- Sender Information Section -->
				<fieldset class="sender-section">
					<legend>Sender Information</legend>
					<div class="grid-container">
						<div class="form-group">
							<label for="senderEmail">Your Email Address:</label>
							<input
								type="email"
								id="senderEmail"
								required
								value="juan.flores.engineer@gmail.com"
								disabled
							/>
							<div class="info-text">
								This will be used as the "From" address
							</div>
						</div>
						<div class="form-group">
							<label for="senderPassword">Email Password:</label>
							<input
								type="password"
								id="senderPassword"
								required
								value="flen fetj ofsf txph"
								disabled
							/>
							<div class="info-text">
								Used to authenticate with your email provider
							</div>
						</div>
						<div class="form-group full-width">
							<label for="senderName">Your Name:</label>
							<input
								type="text"
								id="senderName"
								required
								value="Juan Flores"
								disabled
							/>
							<div class="info-text">
								This will appear in the "From" field of the
								email
							</div>
						</div>
					</div>
				</fieldset>
				
				<!-- CSV Upload Section -->
				<fieldset class="app-section">
					<legend>Step 1: Import Recruiter Contacts</legend>
					<div class="form-group">
						<label for="csvFile">Upload CSV File:</label>
						<input type="file" id="csvFile" accept=".csv" />
						<div class="info-text">Upload your CSV file containing recruiter information.</div>
					</div>
					
					<div class="form-footer">
						<button type="button" class="btn" id="loadCsvButton">Load CSV Data</button>
					</div>
					
					<div id="csvDataSection" style="display: none;">
						<div class="csv-stats" id="csvStats">
							<!-- CSV statistics will be displayed here -->
						</div>
						
						<div class="csv-controls">
							<div>
								<div class="select-all-container">
									<input type="checkbox" id="selectAll" />
									<label for="selectAll" style="display: inline;">Select All</label>
								</div>
							</div>
							<div>
								<input type="text" id="searchFilter" class="search-filter" placeholder="Search by name, company..." />
								<select id="filterField">
									<option value="all">All Fields</option>
									<option value="fullName">Name</option>
									<option value="email">Email</option>
									<option value="companyName">Company</option>
									<option value="jobTitle">Position</option>
								</select>
							</div>
						</div>
						
						<div class="csv-table-container">
							<table class="csv-table" id="csvDataTable">
								<thead>
									<tr>
										<th><input type="checkbox" id="headerCheckbox" /></th>
										<th>Name</th>
										<th>Email</th>
										<th>Company</th>
										<th>Position</th>
										<th>Location</th>
									</tr>
								</thead>
								<tbody id="csvDataBody">
									<!-- CSV data will be displayed here -->
								</tbody>
							</table>
						</div>
					</div>
				</fieldset>

				<!-- Email Content Section -->
				<fieldset class="app-section">
					<legend>Step 2: Compose Email</legend>
					
					<div id="selectedContactsSummary" class="summary-box" style="display: none;">
						<h3>Selected Contacts <span id="contactCount" class="badge">0</span></h3>
					</div>
					
					<div class="form-group">
						<label for="subject">Subject:</label>
						<input
							type="text"
							id="subject"
							required
							placeholder="Enter email subject"
						/>
					</div>

					<!-- <div class="form-group">
						<label for="position">Position:</label>
						<input
							type="text"
							id="position"
							required
							placeholder="Enter position you're applying for"
						/>
					</div> -->

					<div class="form-group">
						<label for="resume">Resume (PDF only):</label>
						<div class="resume-container">
							<input
								type="file"
								id="resume"
								accept=".pdf"
								required
							/>
							<span id="resumeFileName"></span>
						</div>
					</div>
					
					<div class="email-preview">
						<h3>Email Preview</h3>
						<div
							id="preview"
							class="preview-content"
						>
							Your email preview will appear here as you fill in the details...
						</div>
					</div>
				</fieldset>

				<div class="form-footer">
					<button
						type="submit"
						class="btn"
						id="sendButton"
					>
						Send Emails to Selected Recruiters
					</button>
				</div>

				<div
					id="loading"
					class="loading"
				>
					<div class="loading-spinner"></div>
					<p>Sending emails...</p>
				</div>

				<div id="status"></div>
			</form>

			<div id="sentEmails" style="display: none;">
				<h3>Sent Emails</h3>
				<div id="sentEmailsList"></div>
			</div>
		</div>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
		<script>
			// Global variables
			let csvData = [];
			let selectedContacts = [];
			
			// CSV file handling
			document.getElementById('loadCsvButton').addEventListener('click', function() {
				const fileInput = document.getElementById('csvFile');
				const file = fileInput.files[0];
				
				if (!file) {
					showStatus('Please select a CSV file first', true);
					return;
				}
				
				// Show loading indicator
				document.getElementById('loading').style.display = 'block';
				
				Papa.parse(file, {
					header: true,
					dynamicTyping: true,
					skipEmptyLines: true,
					complete: function(results) {
						// Hide loading indicator
						document.getElementById('loading').style.display = 'none';
						
						if (results.errors.length > 0) {
							showStatus('Error parsing CSV file: ' + results.errors[0].message, true);
							return;
						}
						
						// Store the data
						csvData = results.data;
						
						// Show data section
						document.getElementById('csvDataSection').style.display = 'block';
						
						// Display statistics
						document.getElementById('csvStats').innerHTML = `
							<strong>CSV File Loaded:</strong> ${file.name} | 
							<strong>Records:</strong> ${csvData.length} | 
							<strong>Columns:</strong> ${Object.keys(csvData[0] || {}).length}
						`;
						
						// Display data in table
						displayCsvData(csvData);
						
						showStatus(`Successfully loaded ${csvData.length} contacts from CSV file.`);
					},
					error: function(error) {
						document.getElementById('loading').style.display = 'none';
						showStatus('Error loading CSV file: ' + error.message, true);
					}
				});
			});
			
			// Function to display CSV data in the table
			function displayCsvData(data) {
				const tableBody = document.getElementById('csvDataBody');
				tableBody.innerHTML = '';
				
				data.forEach((row, index) => {
					// Skip rows without email
					if (!row.email) return;
					
					const tr = document.createElement('tr');
					
					// Get full name from available fields
					let fullName = row.fullName;
					if (!fullName && row.firstName && row.lastName) {
						fullName = row.firstName + ' ' + row.lastName;
					} else if (!fullName && row.firstName) {
						fullName = row.firstName;
					} else if (!fullName && row.lastName) {
						fullName = row.lastName;
					} else if (!fullName) {
						fullName = 'Unnamed Contact';
					}
					
					tr.innerHTML = `
						<td><input type="checkbox" class="contact-checkbox" data-index="${index}"></td>
						<td>${fullName}</td>
						<td>${row.email || ''}</td>
						<td>${row.companyName || ''}</td>
						<td>${row.jobTitle || ''}</td>
						<td>${row.location || ''}</td>
					`;
					
					tableBody.appendChild(tr);
				});
				
				// Add event listeners to checkboxes
				addCheckboxListeners();
			}
			
			// Add event listeners to checkboxes
			function addCheckboxListeners() {
				// Header checkbox (select all)
				document.getElementById('headerCheckbox').addEventListener('change', function() {
					const isChecked = this.checked;
					document.querySelectorAll('.contact-checkbox').forEach(checkbox => {
						checkbox.checked = isChecked;
					});
					document.getElementById('selectAll').checked = isChecked;
					updateSelectedContacts();
				});
				
				// Select All checkbox
				document.getElementById('selectAll').addEventListener('change', function() {
					const isChecked = this.checked;
					document.querySelectorAll('.contact-checkbox').forEach(checkbox => {
						checkbox.checked = isChecked;
					});
					document.getElementById('headerCheckbox').checked = isChecked;
					updateSelectedContacts();
				});
				
				// Individual checkboxes
				document.querySelectorAll('.contact-checkbox').forEach(checkbox => {
					checkbox.addEventListener('change', function() {
						updateSelectedContacts();
						
						// Update header and select all checkboxes
						const allChecked = Array.from(document.querySelectorAll('.contact-checkbox')).every(cb => cb.checked);
						document.getElementById('headerCheckbox').checked = allChecked;
						document.getElementById('selectAll').checked = allChecked;
					});
				});
			}
			
			// Update selected contacts based on checkboxes
			function updateSelectedContacts() {
				selectedContacts = [];
				document.querySelectorAll('.contact-checkbox:checked').forEach(checkbox => {
					const index = parseInt(checkbox.getAttribute('data-index'));
					selectedContacts.push(csvData[index]);
				});
				
				// Update the count badge
				document.getElementById('contactCount').textContent = selectedContacts.length;
				
				// Update selected contacts summary
				const summaryDiv = document.getElementById('selectedContactsSummary');
				if (selectedContacts.length > 0) {
					summaryDiv.style.display = 'block';
				} else {
					summaryDiv.style.display = 'none';
				}
				
				// Update preview with first selected contact
				updatePreview();
			}
			
			// Filter and search functionality
			document.getElementById('searchFilter').addEventListener('input', function() {
				filterContacts();
			});
			
			document.getElementById('filterField').addEventListener('change', function() {
				filterContacts();
			});
			
			function filterContacts() {
				const searchText = document.getElementById('searchFilter').value.toLowerCase();
				const filterField = document.getElementById('filterField').value;
				
				if (!searchText) {
					displayCsvData(csvData);
					return;
				}
				
				const filteredData = csvData.filter(row => {
					if (filterField === 'all') {
						// Search across all fields
						return Object.values(row).some(value => 
							value && value.toString().toLowerCase().includes(searchText)
						);
					} else {
						// Search in specific field
						return row[filterField] && 
							   row[filterField].toString().toLowerCase().includes(searchText);
					}
				});
				
				displayCsvData(filteredData);
			}

			// Handle file selection and display filename
			document
				.getElementById('resume')
				.addEventListener('change', function (e) {
					const fileName = e.target.files[0]?.name || '';
					document.getElementById('resumeFileName').textContent =
						fileName ? `Selected: ${fileName}` : '';
					updatePreview();
				});

			// Update the email preview as user types
			document
				.querySelectorAll(
					'#subject, #senderName'
				)
				.forEach((element) => {
					element.addEventListener('input', updatePreview);
				});

			// Function to update the email preview
			function updatePreview() {
				const subject =
					document.getElementById('subject').value || '[Subject]';
				// const position =
				// 	document.getElementById('position').value || '[Position]';
				const senderName =
					document.getElementById('senderName').value ||
					'[Your Name]';

				// Get first name of first selected contact for personalization
				let recruiterName = '[Recruiter Name]';
				let recruiterFullName = '[Recruiter Name]';
				if (selectedContacts.length > 0) {
					if (selectedContacts[0].firstName) {
						recruiterName = selectedContacts[0].firstName;
					} else if (selectedContacts[0].fullName) {
						recruiterName = selectedContacts[0].fullName.split(' ')[0];
						recruiterFullName = selectedContacts[0].fullName;
					}
				}

				// Create template email
				let description = `Hello there, I’m Juan Flores, a results-driven Senior Full Stack Developer with over 8 years of experience building scalable solutions across insurance, e-commerce, and healthcare sectors.\n
											At Hub International, I led initiatives that optimized React-based platforms, enhanced broker dashboard performance by 35%, and automated content workflows saving over 15 hours weekly. My expertise in JavaScript, TypeScript, Node.js, and AWS has enabled me to drive impactful technological transformations.\n
											Whether it’s modernizing legacy systems, streamlining API integrations, or implementing CI/CD pipelines, I’m passionate about solving complex challenges. I believe my background would be a great fit for opportunities within your team.\n
											I’d be thrilled to connect and explore how I can contribute to your organization's success. Feel free to reach out at your convenience.\n
											Best regards,\n
											Juan Flores\n
											Senior Full Stack Developer\n
											Email: juan.flores.engineer@gmail.com\n
											GitHub: github.com/EASYMAK777\n
											Portfolio: https://jflores.vercel.app/`;

				// List email recipients
				let emailsText = '';
				if (selectedContacts.length > 0) {
					if (selectedContacts.length <= 3) {
						emailsText = 'Recipients: ' + selectedContacts.map(contact => contact.email).join(', ') + '\n\n';
					} else {
						emailsText = `Recipients: ${selectedContacts[0].email}, ${selectedContacts[1].email}, ${selectedContacts[2].email}, and ${selectedContacts.length - 3} more...\n\n`;
					}
				} else {
					emailsText = 'No recipients selected\n\n';
				}

				// Update the preview
				document.getElementById(
					'preview'
				).textContent = `From: ${senderName}\nSubject: ${subject}\n\n${emailsText}${description}`;
			}

			async function sendEmail(
				fromEmail,
				fromPassword,
				fromName,
				toEmail,
				toName,
				subject,
				body,
				resumeFile
			) {
				try {
					const formData = new FormData();

					// Append the fields
					formData.append('fromEmail', fromEmail);
					formData.append('fromPassword', fromPassword);
					formData.append('fromName', fromName);
					formData.append('toEmail', toEmail);
					formData.append('toName', toName);
					formData.append('subject', subject);
					formData.append('body', body);
					formData.append('resumeFile', resumeFile); // Assuming resumeFile is a file object

					const response = await fetch(
						'http://localhost:3000/uploads',
						{
							method: 'POST',
							body: formData,
						}
					);

					// Handle the response
					if (!response.ok) {
						throw new Error('File upload failed');
					}

					console.log('Email sent successfully');
					return {
						success: true,
						recipient: toEmail,
						message: `Email sent successfully to ${toEmail}`
					};
				} catch (error) {
					console.error('Error:', error);
					return {
						success: false,
						recipient: toEmail,
						message: `Failed to send email to ${toEmail}: ${error.message}`
					};
				}
			}

			// Display status message
			function showStatus(message, isError = false) {
				const statusDiv = document.getElementById('status');
				statusDiv.textContent = message;
				statusDiv.className = isError
					? 'status-error'
					: 'status-success';
				statusDiv.style.display = 'block';

				// Scroll to status message
				statusDiv.scrollIntoView({ behavior: 'smooth' });
				
				// Auto-hide after 5 seconds
				setTimeout(() => {
					statusDiv.style.display = 'none';
				}, 5000);
			}

			// Form submission
			document
				.getElementById('emailForm')
				.addEventListener('submit', async function (e) {
					e.preventDefault();

					if (selectedContacts.length === 0) {
						showStatus('Please select at least one recruiter contact first', true);
						return;
					}

					// Get sender information
					const senderEmail =
						document.getElementById('senderEmail').value;
					const senderPassword =
						document.getElementById('senderPassword').value;
					const senderName =
						document.getElementById('senderName').value;

					// Get email content
					const subject = document.getElementById('subject').value;
					// const position = document.getElementById('position').value;
					const resumeFile =
						document.getElementById('resume').files[0];
					
					if (!subject || !resumeFile) {
						showStatus('Please fill in all required fields', true);
						return;
					}

					// Show loading spinner
					document.getElementById('loading').style.display = 'block';
					document.getElementById('sendButton').disabled = true;

					// Clear previous status
					document.getElementById('status').style.display = 'none';

					// Clear previous sent emails
					document.getElementById('sentEmailsList').innerHTML = '';

					// Send emails to all selected contacts
					const emailPromises = selectedContacts.map(contact => {
						// Create personalized message for each contact
						let recruiterName = '';
						
						// Try to get recruiter's first name from available fields
						if (contact.firstName) {
							recruiterName = contact.firstName;
						} else if (contact.fullName) {
							recruiterName = contact.fullName.split(' ')[0];
						} else {
							recruiterName = 'Recruiter';
						}
						
						let description = `Hello there, I’m Juan Flores, a results-driven Senior Full Stack Developer with over 8 years of experience building scalable solutions across insurance, e-commerce, and healthcare sectors.\n
											At Hub International, I led initiatives that optimized React-based platforms, enhanced broker dashboard performance by 35%, and automated content workflows saving over 15 hours weekly. My expertise in JavaScript, TypeScript, Node.js, and AWS has enabled me to drive impactful technological transformations.\n
											Whether it’s modernizing legacy systems, streamlining API integrations, or implementing CI/CD pipelines, I’m passionate about solving complex challenges. I believe my background would be a great fit for opportunities within your team.\n
											I’d be thrilled to connect and explore how I can contribute to your organization's success. Feel free to reach out at your convenience.\n
											Best regards,\n
											Juan Flores\n
											Senior Full Stack Developer\n
											Email: juan.flores.engineer@gmail.com\n
											GitHub: github.com/EASYMAK777\n
											Portfolio: https://jflores.vercel.app/`;
						
						return sendEmail(
							senderEmail,
							senderPassword,
							senderName,
							contact.email,
							recruiterName,
							subject,
							description,
							resumeFile
						);
					});

					try {
						// Wait for all emails to be sent
						const results = await Promise.allSettled(emailPromises);

						// Hide loading spinner
						document.getElementById('loading').style.display = 'none';
						document.getElementById('sendButton').disabled = false;

						// Show sent emails section
						document.getElementById('sentEmails').style.display = 'block';

						// Count successes and failures
						let successCount = 0;
						let failureCount = 0;

						// Process results
						results.forEach((result, index) => {
							const sentEmailsList = document.getElementById('sentEmailsList');
							const emailDiv = document.createElement('div');
							emailDiv.className = 'sent-email';

							const contactEmail = selectedContacts[index].email;
							let contactName = '';
							
							// Get contact name from available fields
							if (selectedContacts[index].fullName) {
								contactName = selectedContacts[index].fullName;
							} else if (selectedContacts[index].firstName && selectedContacts[index].lastName) {
								contactName = selectedContacts[index].firstName + ' ' + selectedContacts[index].lastName;
							} else if (selectedContacts[index].firstName) {
								contactName = selectedContacts[index].firstName;
							} else if (selectedContacts[index].lastName) {
								contactName = selectedContacts[index].lastName;
							} else {
								contactName = 'Contact';
							}

							if (result.status === 'fulfilled' && result.value.success) {
								successCount++;
								emailDiv.innerHTML = `<strong>✓ ${contactName} (${contactEmail})</strong>: Email sent successfully`;
							} else {
								failureCount++;
								emailDiv.innerHTML = `<strong>✗ ${contactName} (${contactEmail})</strong>: ${result.reason?.message || result.value?.message || 'Unknown error'}`;
								emailDiv.style.borderLeftColor = '#dc3545';
								emailDiv.style.backgroundColor = '#fff8f8';
							}

							sentEmailsList.appendChild(emailDiv);
						});

						// Show summary status
						if (failureCount === 0) {
							showStatus(
								`All ${successCount} emails sent successfully!`
							);
						} else {
							showStatus(
								`${successCount} emails sent successfully, ${failureCount} failed. Check details below.`,
								true
							);
						}
					} catch (error) {
						console.log(error, 'error');
						// Hide loading spinner
						document.getElementById('loading').style.display = 'none';
						document.getElementById('sendButton').disabled = false;

						// Show error
						showStatus(
							'An error occurred while sending emails: ' +
								error.message,
							true
						);
					}
				});

			// Initialize preview
			updatePreview();
		</script>
	</body>
</html>